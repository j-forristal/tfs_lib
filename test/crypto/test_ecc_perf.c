#include <stdio.h>
#include <string.h>
#include <assert.h>
#include <time.h>

#include "tf_crypto.h"

extern void dump_hex( uint8_t* hex, uint32_t cnt );

static const uint8_t SIG[]={
//0x30,0x45,0x02,0x20,
0x00,0x8e,0x51,0x1c,0x13,0xf3,0x0d,0xdd,
0xd5,0x94,0x96,0x16,0x59,0x24,0x15,0x13,
0xbe,0x78,0x12,0xb3,0xbe,0x77,0x13,0xf4,
0xab,0xc3,0x98,0x16,0x72,0xcb,0xf7,0x2f,
//0x02,0x21,0x00,
0xa6,0x82,0x27,0x1c,0x78,0xbc,0x9b,0xb7,
0xaa,0xdd,0x6a,0x73,0xae,0xd4,0xa2,0xe3,
0x59,0xab,0x77,0x9a,0x78,0xfb,0x2f,0x39,
0xd5,0x59,0x6f,0x3a,0x63,0x7a,0x19,0x3e
};

static const uint8_t PK[]={
    0x5f,0x6c,0x02,0x7f,0x10,0xee,0x74,0x31,0xd6,0x67,0x87,0x12,0xa9,0x83,
    0xb9,0xa8,0x75,0xb9,0x75,0x50,0xa0,0xa7,0xb3,0x13,0xeb,0xca,0xe0,0xf4,0x3e,
    0xe3,0xf8,0x47,0xb7,0x56,0xbb,0xa3,0x33,0x33,0xe2,0x2f,0x18,0x10,0x27,0x66,
    0xd8,0xca,0x67,0x72,0xb0,0xce,0x83,0xaf,0x38,0xf7,0xf8,0xce,0x4b,0x95,0xc0,
    0x80,0x7d,0x9c,0xbc,0x40
};

int main(void){
	uint8_t digest[TFC_SHA1_DIGEST_SIZE];
	TFC_SHA1_Ctx_t ctx;
	TFC_SHA1_Init(&ctx);
	TFC_SHA1_Update(&ctx,(uint8_t*)"hello\n",6);
	TFC_SHA1_Final(&ctx,digest);

	int i;
	time_t t1 = time(0);
#define PERF_COUNT (8 * 1024)
	for( i=0; i<PERF_COUNT; i++){
		assert(  TFC_ECC_Verify( (uint8_t*)PK, sizeof(PK),
		digest, TFC_SHA1_DIGEST_SIZE, (uint8_t*)SIG, sizeof(SIG) ) == 1 );
	}
	time_t t2 = time(0);
	printf("ASC time for %d iterations: %ds\n", i, (int)(t2 - t1));

	return 0;
}
